@inherits LayoutComponentBase
@inject IJSRuntime JS

<div class="weather-page @(isDarkTheme ? "dark-theme" : "light-theme")">

    <!-- 🌗 GLOBAL THEME TOGGLE -->
    <div class="text-end p-3">
        <button class="btn btn-sm btn-outline-secondary"
                @onclick="ToggleTheme">
            @(isDarkTheme ? "☀️ Light Mode" : "🌙 Dark Mode")
        </button>
    </div>

    <!-- ☁️ CLOUDS (VISIBLE ON ALL PAGES) -->
    <img src="/images/cloud1.png" class="cloud cloud1" />
    <img src="/images/cloud1.png" class="cloud cloud2" />
    <img src="/images/cloud1.png" class="cloud cloud3" />

    <!-- PAGE CONTENT -->
    <div class="container">
        @Body
    </div>

</div>

@code {
    private bool isDarkTheme;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var theme = await JS.InvokeAsync<string>("themeManager.getTheme");
            isDarkTheme = theme == "dark";
            StateHasChanged();
        }
    }

    private async Task ToggleTheme()
    {
        isDarkTheme = !isDarkTheme;
        await JS.InvokeVoidAsync(
            "themeManager.setTheme",
            isDarkTheme ? "dark" : "light"
        );
    }
}
